<%- include('../layouts/main', {
  title: title,
  settings: settings,
  body: `
    <!-- Page Header -->
    <section class="page-header bg-success bg-opacity-10 py-5">
      <div class="container">
        <div class="text-center">
          <h1 class="display-4 fw-bold text-success mb-2">Pencarian</h1>
          <p class="lead text-muted">Temukan artikel yang Anda cari</p>
        </div>
      </div>
    </section>

    <!-- Search Section -->
    <section class="py-5">
      <div class="container">
        <!-- Search Form -->
        <div class="row justify-content-center mb-5">
          <div class="col-lg-8">
            <form action="/cari" method="GET" class="card border-0 shadow-sm">
              <div class="card-body">
                <div class="input-group input-group-lg">
                  <input type="text" 
                         class="form-control" 
                         name="q" 
                         value="${query}" 
                         placeholder="Cari berita, artikel, kegiatan..." 
                         required>
                  <button class="btn btn-success px-4" type="submit">
                    <i class="bi bi-search me-2"></i>Cari
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        ${query ? `
          <!-- Search Results -->
          <div class="mb-4">
            <h5 class="text-muted">
              ${results.length > 0 
                ? 'Ditemukan <strong>' + results.length + '</strong> hasil untuk "<strong>' + query + '</strong>"'
                : 'Tidak ada hasil untuk "<strong>' + query + '</strong>"'
              }
            </h5>
          </div>

          ${results.length > 0 ? `
            <div class="row g-4">
              ${results.map(post => {
                const imageUrl = post.featuredImage 
                  ? (typeof post.featuredImage === 'object' ? post.featuredImage.url : post.featuredImage)
                  : '/images/default-post.jpg';
                
                // Get category in English
                const categoryEn = typeof post.category === 'object' 
                  ? post.category.name 
                  : post.category;

                // Map to Indonesian
                const categoryMap = {
                  'news': 'Berita',
                  'activity': 'Kegiatan',
                  'announcement': 'Pengumuman',
                  'achievement': 'Prestasi'
                };
                const categoryId = categoryMap[categoryEn] || categoryEn || 'Umum';

                // Category badge color
                const categoryColor = {
                  'news': 'primary',
                  'activity': 'success',
                  'announcement': 'warning text-dark',
                  'achievement': 'info'
                };
                const badgeColor = categoryColor[categoryEn] || 'secondary';

                const publishedDate = new Date(post.publishedDate).toLocaleDateString('id-ID', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                });

                return '<div class="col-md-6 col-lg-4">' +
                  '<article class="card h-100 border-0 shadow-sm hover-lift">' +
                    '<img src="' + imageUrl + '" class="card-img-top" alt="' + post.title + '" style="height: 200px; object-fit: cover;">' +
                    '<div class="card-body">' +
                      '<div class="mb-2">' +
                        '<span class="badge bg-' + badgeColor + '">' + categoryId + '</span>' +
                      '</div>' +
                      '<h5 class="card-title">' +
                        '<a href="/berita/' + post.slug + '" class="text-decoration-none text-dark">' +
                          post.title +
                        '</a>' +
                      '</h5>' +
                      '<p class="card-text text-muted small">' +
                        (post.excerpt || '') +
                      '</p>' +
                    '</div>' +
                    '<div class="card-footer bg-transparent border-0">' +
                      '<div class="d-flex justify-content-between align-items-center text-muted small">' +
                        '<span>' +
                          '<i class="bi bi-calendar me-1"></i>' +
                          publishedDate +
                        '</span>' +
                        '<span>' +
                          '<i class="bi bi-eye me-1"></i>' +
                          (post.views || 0) +
                        '</span>' +
                      '</div>' +
                    '</div>' +
                  '</article>' +
                '</div>';
              }).join('')}
            </div>
          ` : `
            <div class="text-center py-5">
              <i class="bi bi-search fs-1 text-muted mb-3 d-block"></i>
              <h4 class="text-muted">Tidak ada hasil ditemukan</h4>
              <p class="text-muted">Coba gunakan kata kunci yang berbeda</p>
            </div>
          `}
        ` : `
          <!-- No Search Yet -->
          <div class="text-center py-5">
            <i class="bi bi-search fs-1 text-success mb-3 d-block"></i>
            <h4 class="text-muted">Mulai Pencarian</h4>
            <p class="text-muted">Masukkan kata kunci untuk mencari berita, artikel, atau kegiatan</p>
          </div>
        `}
      </div>
    </section>

    <style>
      .hover-lift {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
      }
    </style>
  `
}) %>